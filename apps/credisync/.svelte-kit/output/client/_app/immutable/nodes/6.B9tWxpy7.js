const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/BFDErIkF.js","../chunks/CanLVora.js","../chunks/DeuNT0YN.js"])))=>i.map(i=>d[i]);
import"../chunks/DsnmJJEf.js";import{D as Ue,p as ke,P as de,o as We,f as m,c as w,s as r,J as Qe,t as R,I as De,a as v,b as Ae,g as i,E as U,j as p,h as n,r as a,l as O,K as qe,F as Ze,e as eo,d as P,A as oo,B as to,k as M,H as ce,W as ro,y as ao,z as no,q as io}from"../chunks/C5jdwYbG.js";import{g as Ie}from"../chunks/B-veEkgC.js";import"../chunks/DG34qsx6.js";import{i as lo}from"../chunks/DhBo1QyW.js";import"../chunks/CanLVora.js";import{c as so}from"../chunks/BFDErIkF.js";import{_ as co}from"../chunks/PPVm8Dsz.js";const T={MX:{name:"MÃ©xico",flag:"ğŸ‡²ğŸ‡½",code:"MX",phone:{digits:10,code:"+52",whatsapp:"+52",example:"5512345678",format:"(55) 1234-5678"},currency:"MXN",currencySymbol:"$",default:!0},CO:{name:"Colombia",flag:"ğŸ‡¨ğŸ‡´",code:"CO",phone:{digits:10,code:"+57",whatsapp:"+57",example:"3001234567",format:"(300) 123-4567"},currency:"COP",currencySymbol:"$"},PE:{name:"PerÃº",flag:"ğŸ‡µğŸ‡ª",code:"PE",phone:{digits:9,code:"+51",whatsapp:"+51",example:"987654321",format:"987-654-321"},currency:"PEN",currencySymbol:"S/"},AR:{name:"Argentina",flag:"ğŸ‡¦ğŸ‡·",code:"AR",phone:{digits:[10,11],code:"+54",whatsapp:"+549",example:"1123456789",format:"(11) 2345-6789"},currency:"ARS",currencySymbol:"$"},BR:{name:"Brasil",flag:"ğŸ‡§ğŸ‡·",code:"BR",phone:{digits:11,code:"+55",whatsapp:"+55",example:"11987654321",format:"(11) 98765-4321"},currency:"BRL",currencySymbol:"R$"}};async function uo(){console.log("ğŸŒ [COUNTRY] Iniciando detecciÃ³n automÃ¡tica de paÃ­s...");const d=localStorage.getItem("credisync_country");if(d&&T[d])return console.log("ğŸŒ [COUNTRY] PaÃ­s guardado encontrado:",d),{country:d,method:"saved",confidence:"high"};try{console.log("ğŸ“ [COUNTRY] Intentando detecciÃ³n por GPS...");const t=await fo();if(t.country)return console.log("âœ… [COUNTRY] PaÃ­s detectado por GPS:",t.country),t}catch(t){console.log("âš ï¸ [COUNTRY] GPS no disponible:",t.message)}try{console.log("ğŸŒ [COUNTRY] Intentando detecciÃ³n por IP...");const t=await po();if(t.country)return console.log("âœ… [COUNTRY] PaÃ­s detectado por IP:",t.country),t}catch(t){console.log("âš ï¸ [COUNTRY] IP geolocation fallÃ³:",t.message)}return console.log("ğŸ‡²ğŸ‡½ [COUNTRY] Usando MÃ©xico como paÃ­s por defecto"),{country:"MX",method:"default",confidence:"low"}}async function fo(){const{captureLocation:d}=await co(async()=>{const{captureLocation:o}=await import("../chunks/BFDErIkF.js").then(c=>c.l);return{captureLocation:o}},__vite__mapDeps([0,1,2]),import.meta.url),t=await d({timeout:3e3,enableHighAccuracy:!1});if(!t.location)throw new Error("No se pudo obtener ubicaciÃ³n GPS");const{latitude:u,longitude:l}=t.location,E={MX:{latMin:14.5,latMax:32.7,lonMin:-118.4,lonMax:-86.7},CO:{latMin:-4.2,latMax:12.5,lonMin:-81.7,lonMax:-66.9},PE:{latMin:-18.3,latMax:-.04,lonMin:-81.3,lonMax:-68.7},AR:{latMin:-55.1,latMax:-21.8,lonMin:-73.6,lonMax:-53.6},BR:{latMin:-33.7,latMax:5.3,lonMin:-73.9,lonMax:-28.8}};for(const[o,c]of Object.entries(E))if(u>=c.latMin&&u<=c.latMax&&l>=c.lonMin&&l<=c.lonMax)return{country:o,method:"gps",confidence:"high",coordinates:{latitude:u,longitude:l}};throw new Error("PaÃ­s no identificado por coordenadas GPS")}async function po(){const d=await fetch("https://ipapi.co/json/",{signal:AbortSignal.timeout(2e3)});if(!d.ok)throw new Error(`HTTP ${d.status}`);const t=await d.json();if(!t.country_code)throw new Error("No se pudo determinar paÃ­s por IP");const l={MX:"MX",CO:"CO",PE:"PE",AR:"AR",BR:"BR"}[t.country_code];if(!l)throw new Error(`PaÃ­s ${t.country_code} no soportado`);return{country:l,method:"ip",confidence:"medium",ipInfo:{country:t.country_name,city:t.city,region:t.region}}}function Be(d,t){if(!d||!t||!T[t])return{valid:!1,error:"Datos invÃ¡lidos"};const u=T[t].phone,l=d.replace(/\D/g,"");if(Array.isArray(u.digits)){if(!u.digits.includes(l.length))return{valid:!1,error:`Debe tener ${u.digits.join(" o ")} dÃ­gitos`}}else if(l.length!==u.digits)return{valid:!1,error:`Debe tener ${u.digits} dÃ­gitos`};return{valid:!0,formatted:l,international:u.code+l}}function vo(d,t){const u=Be(d,t);if(!u.valid)return d;T[t].phone;const l=u.formatted;switch(t){case"MX":case"CO":if(l.length===10)return`(${l.slice(0,3)}) ${l.slice(3,6)}-${l.slice(6)}`;break;case"PE":if(l.length===9)return`${l.slice(0,3)}-${l.slice(3,6)}-${l.slice(6)}`;break;case"AR":if(l.length>=10){const E=l.slice(0,l.length===10?2:3),o=l.slice(E.length);return`(${E}) ${o.slice(0,4)}-${o.slice(4)}`}break;case"BR":if(l.length===11)return`(${l.slice(0,2)}) ${l.slice(2,7)}-${l.slice(7)}`;break}return l}function bo(d){return T[d]||T.MX}function go(){return Object.entries(T).map(([d,t])=>({code:d,name:t.name,flag:t.flag,displayName:`${t.flag} ${t.name}`}))}function mo(d){T[d]&&(localStorage.setItem("credisync_country",d),console.log("ğŸ’¾ [COUNTRY] Preferencia guardada:",d))}var yo=m('<span class="detecting svelte-1qobh6v">ğŸ” Detectando...</span>'),_o=m("<option> </option>"),xo=m('<span class="detection-hint svelte-1qobh6v">Puedes cambiar el paÃ­s si es incorrecto</span>'),ho=m('<div><span class="detection-message svelte-1qobh6v"> </span> <!></div>'),wo=m('<div class="country-selector svelte-1qobh6v"><label for="country-select" class="form-label svelte-1qobh6v">PaÃ­s <!></label> <select id="country-select" class="country-select svelte-1qobh6v"></select> <!></div>');function Co(d,t){ke(t,!0);let u=de(t,"selectedCountry",15,"MX"),l=de(t,"showDetectionInfo",3,!0),E=de(t,"disabled",3,!1),o=go(),c=U(null),$=U(!1);We(async()=>{await _()});async function _(){p($,!0);try{const f=await uo();u(f.country),p(c,f,!0),console.log("ğŸŒ [COUNTRY-SELECTOR] PaÃ­s detectado:",f)}catch(f){console.error("âŒ [COUNTRY-SELECTOR] Error detectando paÃ­s:",f),u("MX"),p(c,{country:"MX",method:"error",confidence:"low"},!0)}finally{p($,!1)}}function j(){mo(u()),i(c)&&i(c).method!=="saved"&&p(c,{...i(c),method:"manual",confidence:"high"},!0)}function S(){if(!i(c))return"";switch(i(c).method){case"gps":return"ğŸ“ Detectado por ubicaciÃ³n GPS";case"ip":return"ğŸŒ Detectado por ubicaciÃ³n IP";case"saved":return"ğŸ’¾ Preferencia guardada";case"manual":return"ğŸ‘¤ Seleccionado manualmente";case"default":return"ğŸ‡²ğŸ‡½ PaÃ­s por defecto";case"error":return"âš ï¸ No se pudo detectar, usando MÃ©xico";default:return""}}function x(){if(!i(c))return"";switch(i(c).confidence){case"high":return"confidence-high";case"medium":return"confidence-medium";case"low":return"confidence-low";default:return""}}var I=wo(),k=n(I),F=r(n(k));{var L=f=>{var b=yo();v(f,b)};w(F,f=>{i($)&&f(L)})}a(k);var h=r(k,2);h.__change=j,Qe(h,21,()=>o,f=>f.code,(f,b)=>{var y=_o(),D=n(y,!0);a(y);var N={};R(()=>{O(D,i(b).displayName),N!==(N=i(b).code)&&(y.value=(y.__value=i(b).code)??"")}),v(f,y)}),a(h);var X=r(h,2);{var Y=f=>{var b=ho(),y=n(b),D=n(y,!0);a(y);var N=r(y,2);{var A=C=>{var q=xo();v(C,q)};w(N,C=>{i(c).confidence==="low"&&C(A)})}a(b),R((C,q)=>{qe(b,1,`detection-info ${C??""}`,"svelte-1qobh6v"),O(D,q)},[x,S]),v(f,b)};w(X,f=>{l()&&i(c)&&!i($)&&f(Y)})}a(I),R(()=>h.disabled=E()),De(h,u),v(d,I),Ae()}Ue(["change"]);var Po=m('<div class="flex items-center gap-2 bg-white/20 px-3 py-1.5 rounded-lg"><div class="w-2 h-2 bg-yellow-300 rounded-full animate-pulse"></div> <span class="text-white text-xs font-medium">Modo Offline</span></div>'),Mo=m('<span class="text-green-600"> </span>'),Ro=m('<span class="text-red-600"> </span>'),Eo=m('<p class="mt-2 text-sm text-green-600"> </p>'),$o=m('<div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl"> </div>'),No=m('<div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-xl"> </div>'),Oo=m('<span class="flex items-center justify-center gap-2"><div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Guardando...</span>'),To=m('<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50"><div class="w-full max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6"><div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden"><div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4"><div class="flex items-center justify-between"><div><h1 class="text-xl font-bold text-white">Nuevo Cliente</h1> <p class="text-blue-100 text-sm mt-1">Completa la informaciÃ³n del cliente</p></div> <!></div></div> <form class="p-6 space-y-6"><div><h2 class="text-lg font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-600">ğŸ“‹ InformaciÃ³n Personal</h2> <div class="mb-6"><!></div> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="md:col-span-2"><label for="nombre" class="block text-sm font-semibold text-gray-700 mb-2">Nombre Completo <span class="text-red-500">*</span></label> <input id="nombre" type="text" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Ej: Juan PÃ©rez GarcÃ­a"/></div> <div><label for="tipo_documento" class="block text-sm font-semibold text-gray-700 mb-2">Tipo de Documento <span class="text-red-500">*</span></label> <select id="tipo_documento" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"><option>CURP</option><option>INE</option><option>CÃ©dula</option></select></div> <div><label for="numero_documento" class="block text-sm font-semibold text-gray-700 mb-2">NÃºmero de Documento <span class="text-red-500">*</span></label> <input id="numero_documento" type="text" inputmode="text" required class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Ej: PEGJ850101HDFRNN09"/></div> <div><label for="telefono" class="block text-sm font-semibold text-gray-700 mb-2">TelÃ©fono Principal <span class="text-red-500">*</span></label> <input id="telefono" type="tel" required/> <div class="mt-1 text-xs text-gray-600"> <!></div></div> <div><label for="telefono_2" class="block text-sm font-semibold text-gray-700 mb-2">TelÃ©fono Secundario</label> <input id="telefono_2" type="tel" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="555-5678 (opcional)"/></div></div></div> <div><h2 class="text-lg font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-600">ğŸ“ DirecciÃ³n</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="md:col-span-2"><label for="direccion" class="block text-sm font-semibold text-gray-700 mb-2">DirecciÃ³n</label> <input id="direccion" type="text" inputmode="text" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Calle Principal #123"/></div> <div><label for="barrio" class="block text-sm font-semibold text-gray-700 mb-2">Barrio/Colonia</label> <input id="barrio" type="text" inputmode="text" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Centro (opcional)"/></div> <div><label for="referencia" class="block text-sm font-semibold text-gray-700 mb-2">Referencia</label> <input id="referencia" type="text" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Frente a la farmacia (opcional)"/></div> <div class="md:col-span-2"><button type="button" class="px-4 py-2 bg-green-50 text-green-700 border border-green-200 rounded-xl hover:bg-green-100 transition-all font-medium">ğŸ“ Obtener UbicaciÃ³n GPS</button> <!></div></div></div> <div><h2 class="text-lg font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-600">ğŸ‘¤ InformaciÃ³n del Fiador (Opcional)</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div><label for="nombre_fiador" class="block text-sm font-semibold text-gray-700 mb-2">Nombre del Fiador</label> <input id="nombre_fiador" type="text" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="MarÃ­a LÃ³pez SÃ¡nchez (opcional)"/></div> <div><label for="telefono_fiador" class="block text-sm font-semibold text-gray-700 mb-2">TelÃ©fono del Fiador</label> <input id="telefono_fiador" type="tel" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="555-9999 (opcional)"/></div></div></div> <!> <!> <div class="flex gap-4"><button type="button" class="flex-1 px-6 py-4 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all">Cancelar</button> <button type="submit" class="flex-1 bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-semibold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg"><!></button></div></form></div></div></div>');function Go(d,t){ke(t,!0);const u=()=>to(lo,"$isOnline",l),[l,E]=oo();let o=Ze({nombre:"",tipo_documento:"CURP",numero_documento:"",telefono:"",telefono_2:"",direccion:"",barrio:"",referencia:"",nombre_fiador:"",telefono_fiador:"",latitud:null,longitud:null}),c=U("MX"),$=ce(()=>bo(i(c))),_=ce(()=>Be(o.telefono,i(c))),j=ce(()=>vo(o.telefono,i(c))),S=U(!1),x=U(""),I=U(!1);async function k(e){if(e.preventDefault(),!o.nombre.trim()){p(x,"El nombre es requerido");return}p(S,!0),p(x,""),p(I,!1);try{if(!i(_).valid){p(x,`TelÃ©fono invÃ¡lido: ${i(_).error}`);return}const s={nombre:o.nombre.trim(),tipo_documento:o.tipo_documento,numero_documento:o.numero_documento.trim(),telefono:i(_).formatted,telefono_2:o.telefono_2?.trim()||"",direccion:o.direccion.trim(),barrio:o.barrio?.trim()||"",referencia:o.referencia?.trim()||"",nombre_fiador:o.nombre_fiador?.trim()||"",telefono_fiador:o.telefono_fiador?.trim()||"",latitud:o.latitud,longitud:o.longitud,pais:i(c)};console.log("ğŸ“ [NUEVO-CLIENTE] Guardando cliente con Universal Infrastructure:",s);const g=await so(s);console.log("âœ… [NUEVO-CLIENTE] Cliente creado exitosamente:",g.id),p(I,!0),setTimeout(()=>{Ie("/clientes")},1500)}catch(s){p(x,s.message||"Error al guardar el cliente",!0),console.error("Error guardando cliente:",s)}finally{p(S,!1)}}function F(){Ie("/clientes")}async function L(){if("geolocation"in navigator)try{const e=await new Promise((s,g)=>{navigator.geolocation.getCurrentPosition(s,g)});o.latitud=e.coords.latitude,o.longitud=e.coords.longitude}catch{p(x,"No se pudo obtener la ubicaciÃ³n")}else p(x,"Tu dispositivo no soporta geolocalizaciÃ³n")}var h=To(),X=n(h),Y=n(X),f=n(Y),b=n(f),y=r(n(b),2);{var D=e=>{var s=Po();v(e,s)};w(y,e=>{u()||e(D)})}a(b),a(f);var N=r(f,2),A=n(N),C=r(n(A),2),q=n(C);Co(q,{get selectedCountry(){return i(c)},set selectedCountry(e){p(c,e,!0)}}),a(C);var ue=r(C,2),z=n(ue),fe=r(n(z),2);M(fe),a(z);var H=r(z,2),V=r(n(H),2),J=n(V);J.value=J.__value="CURP";var K=r(J);K.value=K.__value="INE";var pe=r(K);pe.value=pe.__value="CÃ©dula",a(V),a(H);var W=r(H,2),ve=r(n(W),2);M(ve),a(W);var Q=r(W,2),B=r(n(Q),2);M(B);let be;var ge=r(B,2),me=n(ge),Ge=r(me);{var Xe=e=>{var s=Mo(),g=n(s);a(s),R(()=>O(g,`âœ“ ${i(j)??""}`)),v(e,s)},Ye=e=>{var s=ao(),g=no(s);{var le=G=>{var se=Ro(),Ke=n(se);a(se),R(()=>O(Ke,`âœ— ${i(_).error??""}`)),v(G,se)};w(g,G=>{o.telefono&&!i(_).valid&&G(le)},!0)}v(e,s)};w(Ge,e=>{o.telefono&&i(_).valid?e(Xe):e(Ye,!1)})}a(ge),a(Q);var ye=r(Q,2),_e=r(n(ye),2);M(_e),a(ye),a(ue),a(A);var Z=r(A,2),xe=r(n(Z),2),ee=n(xe),he=r(n(ee),2);M(he),a(ee);var oe=r(ee,2),we=r(n(oe),2);M(we),a(oe);var te=r(oe,2),Ce=r(n(te),2);M(Ce),a(te);var Pe=r(te,2),Me=n(Pe);Me.__click=L;var je=r(Me,2);{var Fe=e=>{var s=Eo(),g=n(s);a(s),R((le,G)=>O(g,`âœ… UbicaciÃ³n guardada: ${le??""}, ${G??""}`),[()=>o.latitud.toFixed(6),()=>o.longitud.toFixed(6)]),v(e,s)};w(je,e=>{o.latitud&&o.longitud&&e(Fe)})}a(Pe),a(xe),a(Z);var re=r(Z,2),Re=r(n(re),2),ae=n(Re),Ee=r(n(ae),2);M(Ee),a(ae);var $e=r(ae,2),Ne=r(n($e),2);M(Ne),a($e),a(Re),a(re);var Oe=r(re,2);{var Le=e=>{var s=$o(),g=n(s);a(s),R(()=>O(g,`âš ï¸ ${i(x)??""}`)),v(e,s)};w(Oe,e=>{i(x)&&e(Le)})}var Te=r(Oe,2);{var ze=e=>{var s=No(),g=n(s);a(s),R(()=>O(g,`âœ… Cliente guardado ${u()?"y sincronizado":"localmente. Se sincronizarÃ¡ cuando tengas internet"}`)),v(e,s)};w(Te,e=>{i(I)&&e(ze)})}var Se=r(Te,2),ne=n(Se);ne.__click=F;var ie=r(ne,2),He=n(ie);{var Ve=e=>{var s=Oo();v(e,s)},Je=e=>{var s=io("Guardar Cliente");v(e,s)};w(He,e=>{i(S)?e(Ve):e(Je,!1)})}a(ie),a(Se),a(N),a(Y),a(X),a(h),R(()=>{be=qe(B,1,"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",null,be,{"border-red-300":o.telefono&&!i(_).valid,"border-green-300":o.telefono&&i(_).valid}),ro(B,"placeholder",i($).phone.example),O(me,`${i($).phone.digits??""} dÃ­gitos â€¢ Formato: ${i($).phone.code??""} `),ne.disabled=i(S),ie.disabled=i(S)}),eo("submit",N,k),P(fe,()=>o.nombre,e=>o.nombre=e),De(V,()=>o.tipo_documento,e=>o.tipo_documento=e),P(ve,()=>o.numero_documento,e=>o.numero_documento=e),P(B,()=>o.telefono,e=>o.telefono=e),P(_e,()=>o.telefono_2,e=>o.telefono_2=e),P(he,()=>o.direccion,e=>o.direccion=e),P(we,()=>o.barrio,e=>o.barrio=e),P(Ce,()=>o.referencia,e=>o.referencia=e),P(Ee,()=>o.nombre_fiador,e=>o.nombre_fiador=e),P(Ne,()=>o.telefono_fiador,e=>o.telefono_fiador=e),v(d,h),Ae(),E()}Ue(["click"]);export{Go as component};
