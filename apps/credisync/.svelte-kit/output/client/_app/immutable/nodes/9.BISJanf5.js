import"../chunks/DsnmJJEf.js";import{D as ge,p as me,f as E,h as t,r as e,s,c as S,t as G,g as a,H as Oe,l as c,K as ke,a as _,b as xe,P as Re,E as R,F as le,L as ue,j as m,y as fe,z as ne,k as pe,G as K,Q as Ae,q as De,B as Ie,o as je,d as Se,A as Le,J as Pe}from"../chunks/C5jdwYbG.js";import{g as He}from"../chunks/B-veEkgC.js";import{s as Ne}from"../chunks/DhBo1QyW.js";import{f as U}from"../chunks/Be5qoVR8.js";import"../chunks/CanLVora.js";var Ve=E('<p class="text-sm text-gray-600 mt-1"> </p>'),Te=E('<span class="text-sm text-red-600 font-medium"> </span>'),qe=E('<button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2.5 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">ğŸ’µ Cobrar</button>'),ze=E('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 hover:shadow-md transition-shadow"><div class="flex items-start justify-between mb-3"><div class="flex-1 min-w-0"><h3 class="text-lg font-semibold text-gray-900 truncate"> </h3> <!></div> <span> </span></div> <div class="mb-3"><div class="flex items-baseline gap-2"><span class="text-2xl font-bold text-gray-900"> </span> <!></div> <p class="text-sm text-gray-600 mt-1"> </p></div> <div class="flex gap-2"><!> <button class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium py-2.5 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">ğŸ‘ï¸ Ver</button></div></div>');function Fe(W,r){me(r,!0);const M={AL_DIA:{color:"bg-green-100 text-green-800",icon:"ğŸŸ¢",label:"AL DÃA"},PROXIMO:{color:"bg-yellow-100 text-yellow-800",icon:"ğŸŸ¡",label:"PRÃ“XIMO"},MORA:{color:"bg-red-100 text-red-800",icon:"ğŸ”´",label:"MORA"},SIN_CREDITO:{color:"bg-gray-100 text-gray-800",icon:"âšª",label:"SIN CRÃ‰DITO"}},p=M[r.cliente.estado]||M.SIN_CREDITO,g=Oe(()=>()=>{if(!r.cliente.creditos||r.cliente.creditos.length===0)return"Sin crÃ©ditos activos";const l=[],n=r.cliente.creditos.reduce((C,X)=>C+(X.cuotas_a_cobrar||0),0);return n>0&&(r.cliente.resumen.cuotas_atrasadas>0?l.push(`${n} cuota${n!==1?"s":""} (${r.cliente.resumen.cuotas_atrasadas} atrasada${r.cliente.resumen.cuotas_atrasadas!==1?"s":""})`):l.push(`${n} cuota${n!==1?"s":""} hoy`)),r.cliente.creditos.length>0&&l.push(`${r.cliente.creditos.length} crÃ©dito${r.cliente.creditos.length!==1?"s":""}`),l.join(" â€¢ ")});var b=ze(),h=t(b),x=t(h),w=t(x),z=t(w);e(w);var F=s(w,2);{var i=l=>{var n=Ve(),C=t(n);e(n),G(()=>c(C,`ğŸ“ ${r.cliente.telefono??""}`)),_(l,n)};S(F,l=>{r.cliente.telefono&&l(i)})}e(x);var f=s(x,2),A=t(f);e(f),e(h);var D=s(h,2),I=t(D),B=t(I),J=t(B,!0);e(B);var Q=s(B,2);{var L=l=>{var n=Te(),C=t(n);e(n),G(()=>c(C,`â€¢ ${r.cliente.resumen.dias_atraso_max??""} dÃ­a${r.cliente.resumen.dias_atraso_max!==1?"s":""} atraso`)),_(l,n)};S(Q,l=>{r.cliente.resumen.dias_atraso_max>0&&l(L)})}e(I);var O=s(I,2),k=t(O,!0);e(O),e(D);var P=s(D,2),H=t(P);{var N=l=>{var n=qe();n.__click=()=>r.onCobrar(r.cliente),_(l,n)};S(H,l=>{r.cliente.resumen.total_adeudado>0&&l(N)})}var V=s(H,2);V.__click=()=>r.onVerDetalles(r.cliente),e(P),e(b),G((l,n)=>{c(z,`ğŸ‘¤ ${r.cliente.nombre??""}`),ke(f,1,`ml-3 px-3 py-1 rounded-full text-xs font-medium ${p.color??""} whitespace-nowrap`),c(A,`${p.icon??""} ${p.label??""}`),c(J,l),c(k,n)},[()=>U(r.cliente.resumen.total_adeudado),()=>a(g)()]),_(W,b),xe()}ge(["click"]);var Be=E("<p> </p>"),Qe=E('<span class="inline-block w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></span> Procesando...',1),Xe=E(`<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden"><div class="bg-blue-600 text-white px-6 py-4 flex items-center justify-between"><h2 class="text-xl font-bold flex items-center gap-2"> </h2> <button class="text-white hover:text-gray-200 text-2xl leading-none disabled:opacity-50">Ã—</button></div> <div class="p-6"><div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-2">Monto recibido:</label> <div class="relative"><span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg">$</span> <input type="number" step="0.01" min="0" class="w-full pl-8 pr-4 py-3 text-2xl font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none disabled:bg-gray-100" placeholder="0.00"/></div> <p class="text-sm text-gray-600 mt-1"> </p></div> <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6"><h3 class="font-semibold text-blue-900 mb-2">Resumen del cliente:</h3> <div class="text-sm text-blue-800 space-y-1"><p> </p> <p> </p> <!></div></div> <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6"><p class="text-sm text-yellow-800"><strong>Nota:</strong> Esta es una versiÃ³n simplificada del modal de cobro. 
						La funcionalidad completa serÃ¡ implementada en las prÃ³ximas fases usando @sync/core.</p></div></div> <div class="bg-gray-50 px-6 py-4 flex gap-3"><button class="flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-100 transition-colors disabled:opacity-50">Cancelar</button> <button class="flex-1 px-4 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"><!></button></div></div></div>`);function Ge(W,r){me(r,!0);let M=Re(r,"open",15,!1),p=R(le(r.cliente?.resumen?.total_adeudado||0)),g=R(!1);ue(()=>{M()&&r.cliente?.resumen&&m(p,r.cliente.resumen.total_adeudado,!0)});function b(i){const f=parseFloat(i.target.value)||0;m(p,Math.max(0,f),!0)}async function h(){if(!a(g)){if(a(p)<=0){alert("El monto debe ser mayor a cero");return}try{m(g,!0),await new Promise(i=>setTimeout(i,1e3)),alert(`Pago de ${U(a(p))} registrado exitosamente (simulado)`),M(!1),r.onSuccess&&r.onSuccess()}catch(i){console.error("Error al registrar pago:",i),alert("Error al registrar el pago")}finally{m(g,!1)}}}function x(){a(g)||M(!1)}var w=fe(),z=ne(w);{var F=i=>{var f=Xe();f.__click=x;var A=t(f);A.__click=v=>v.stopPropagation();var D=t(A),I=t(D),B=t(I);e(I);var J=s(I,2);J.__click=x,e(D);var Q=s(D,2),L=t(Q),O=s(t(L),2),k=s(t(O),2);pe(k),k.__input=b,e(O);var P=s(O,2),H=t(P);e(P),e(L);var N=s(L,2),V=s(t(N),2),l=t(V),n=t(l);e(l);var C=s(l,2),X=t(C);e(C);var Y=s(C,2);{var de=v=>{var j=Be(),oe=t(j);e(j),G(()=>c(oe,`â€¢ DÃ­as de atraso: ${r.cliente.resumen.dias_atraso_max??""}`)),_(v,j)};S(Y,v=>{r.cliente.resumen?.dias_atraso_max>0&&v(de)})}e(V),e(N),K(2),e(Q);var Z=s(Q,2),$=t(Z);$.__click=x;var T=s($,2);T.__click=h;var ae=t(T);{var ie=v=>{var j=Qe();K(),_(v,j)},re=v=>{var j=De("âœ“ Confirmar Cobro (Simulado)");_(v,j)};S(ae,v=>{a(g)?v(ie):v(re,!1)})}e(T),e(Z),e(A),e(f),G(v=>{c(B,`ğŸ’µ Cobrar a ${r.cliente.nombre??""}`),J.disabled=a(g),Ae(k,a(p)),k.disabled=a(g),c(H,`Total adeudado: ${v??""}`),c(n,`â€¢ CrÃ©ditos activos: ${(r.cliente.resumen?.creditos_activos||0)??""}`),c(X,`â€¢ Cuotas atrasadas: ${(r.cliente.resumen?.cuotas_atrasadas||0)??""}`),$.disabled=a(g),T.disabled=a(g)||a(p)<=0},[()=>U(r.cliente.resumen?.total_adeudado||0)]),_(i,f)};S(z,i=>{M()&&i(F)})}_(W,w),xe()}ge(["click","input"]);var Je=E('<div class="flex items-center justify-center py-12"><div class="text-center"><div class="inline-block w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div> <p class="text-gray-600">Cargando ruta...</p></div></div>'),Ke=E('<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“­</div> <p class="text-xl text-gray-600 mb-2"> </p> <p class="text-gray-500"> </p></div>'),Ue=E(`<div class="space-y-4"></div> <div class="mt-8 bg-yellow-50 border border-yellow-200 rounded-lg p-4"><p class="text-sm text-yellow-800"><strong>Nota:</strong> Estos son datos de ejemplo para demostrar la funcionalidad del dashboard. 
					En las prÃ³ximas fases se integrarÃ¡ completamente con @sync/core para datos reales.</p></div>`,1),We=E('<div class="min-h-screen bg-gray-50"><div class="bg-white border-b border-gray-200 sticky top-0 z-10"><div class="max-w-7xl mx-auto px-4 py-4"><h1 class="text-2xl font-bold text-gray-900 mb-4">ğŸ“ Mi Ruta</h1> <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4"><div class="bg-blue-50 rounded-lg p-3"><div class="text-2xl font-bold text-blue-900"> </div> <div class="text-xs text-blue-700"> </div></div> <div class="bg-green-50 rounded-lg p-3"><div class="text-2xl font-bold text-green-900"> </div> <div class="text-xs text-green-700"> </div></div> <div class="bg-red-50 rounded-lg p-3"><div class="text-2xl font-bold text-red-900"> </div> <div class="text-xs text-red-700">Montos vencidos</div></div> <div class="bg-yellow-50 rounded-lg p-3"><div class="text-2xl font-bold text-yellow-900"> </div> <div class="text-xs text-yellow-700">Clientes en mora</div></div></div> <div class="relative"><input type="text" placeholder="Buscar cliente..." class="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/> <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</span></div></div></div> <div class="max-w-7xl mx-auto px-4 py-6"><!></div></div> <!>',1);function rt(W,r){me(r,!0);const M=()=>Ie(Ne,"$syncCounter",p),[p,g]=Le();let b=R(le([])),h=R(le([])),x=R(""),w=R(!0),z=R(!1),F=R(null),i=R(le({recaudoEsperado:0,numeroCuotasEsperadas:0,creditosOtorgadosHoy:0,montoOtorgadoHoy:0,montoVencido:0,clientesEnMora:0})),f=R(0);ue(()=>{M()!==a(f)&&!a(w)&&(m(f,M(),!0),A())}),ue(()=>{if(a(x)==="")m(h,a(b),!0);else{const o=a(x).toLowerCase();m(h,a(b).filter(d=>d.nombre?.toLowerCase().includes(o)||d.numero_documento?.toLowerCase().includes(o)||d.telefono?.includes(a(x))),!0)}}),je(async()=>{await A()});async function A(){try{m(w,!0);const o=[];m(b,o,!0),m(h,o,!0),D(),I()}catch(o){console.error("Error cargando datos de ruta:",o)}finally{m(w,!1)}}function D(){a(b).sort((o,d)=>o.estado==="MORA"&&d.estado!=="MORA"?-1:o.estado!=="MORA"&&d.estado==="MORA"?1:o.resumen.total_adeudado!==d.resumen.total_adeudado?d.resumen.total_adeudado-o.resumen.total_adeudado:d.resumen.dias_atraso_max-o.resumen.dias_atraso_max)}function I(){try{const o=a(b).reduce((u,y)=>u+y.resumen.total_adeudado,0),d=a(b).reduce((u,y)=>u+y.resumen.cuotas_atrasadas,0),ee=2,ce=3e3,ve=a(b).filter(u=>u.estado==="MORA").reduce((u,y)=>u+y.resumen.total_adeudado,0),q=a(b).filter(u=>u.estado==="MORA").length;m(i,{recaudoEsperado:o,numeroCuotasEsperadas:d,creditosOtorgadosHoy:ee,montoOtorgadoHoy:ce,montoVencido:ve,clientesEnMora:q},!0)}catch(o){console.error("Error calculando estadÃ­sticas:",o)}}function B(o){m(F,o,!0),m(z,!0)}function J(o){He(`/clientes/${o.id}`)}function Q(){A()}var L=We(),O=ne(L),k=t(O),P=t(k),H=s(t(P),2),N=t(H),V=t(N),l=t(V,!0);e(V);var n=s(V,2),C=t(n);e(n),e(N);var X=s(N,2),Y=t(X),de=t(Y,!0);e(Y);var Z=s(Y,2),$=t(Z);e(Z),e(X);var T=s(X,2),ae=t(T),ie=t(ae,!0);e(ae),K(2),e(T);var re=s(T,2),v=t(re),j=t(v,!0);e(v),K(2),e(re),e(H);var oe=s(H,2),be=t(oe);pe(be),K(2),e(oe),e(P),e(k);var _e=s(k,2),ye=t(_e);{var he=o=>{var d=Je();_(o,d)},we=o=>{var d=fe(),ee=ne(d);{var ce=q=>{var u=Ke(),y=s(t(u),2),te=t(y,!0);e(y);var se=s(y,2),Me=t(se,!0);e(se),e(u),G(()=>{c(te,a(x)?"No se encontraron clientes":"No hay clientes en tu ruta"),c(Me,a(x)?"Intenta con otro tÃ©rmino de bÃºsqueda":"Los clientes con crÃ©ditos activos aparecerÃ¡n aquÃ­")}),_(q,u)},ve=q=>{var u=Ue(),y=ne(u);Pe(y,21,()=>a(h),te=>te.id,(te,se)=>{Fe(te,{get cliente(){return a(se)},onCobrar:B,onVerDetalles:J})}),e(y),K(2),_(q,u)};S(ee,q=>{a(h).length===0?q(ce):q(ve,!1)},!0)}_(o,d)};S(ye,o=>{a(w)?o(he):o(we,!1)})}e(_e),e(O);var Ce=s(O,2);{var Ee=o=>{Ge(o,{get cliente(){return a(F)},onSuccess:Q,get open(){return a(z)},set open(d){m(z,d,!0)}})};S(Ce,o=>{a(F)&&o(Ee)})}G((o,d,ee)=>{c(l,o),c(C,`${a(i).numeroCuotasEsperadas??""} cuotas`),c(de,d),c($,`${a(i).creditosOtorgadosHoy??""} crÃ©ditos hoy`),c(ie,ee),c(j,a(i).clientesEnMora)},[()=>U(a(i).recaudoEsperado),()=>U(a(i).montoOtorgadoHoy),()=>U(a(i).montoVencido)]),Se(be,()=>a(x),o=>m(x,o)),_(W,L),xe(),g()}export{rt as component};
