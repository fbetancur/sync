import"../chunks/DsnmJJEf.js";import{D as Qe,p as Fe,E as w,F as le,L as ne,g as e,B as ie,j as v,o as ze,f as E,s as c,c as g,d as Me,a as i,b as je,A as Oe,h as t,k as Pe,r as a,t as U,l as x,y as B,z as L,J as qe,K as ce,q as K}from"../chunks/C5jdwYbG.js";import{g as ve}from"../chunks/B-veEkgC.js";import{s as Re,i as We}from"../chunks/DhBo1QyW.js";import{a as He}from"../chunks/Be5qoVR8.js";import"../chunks/CanLVora.js";import{g as Je}from"../chunks/BFDErIkF.js";var Ke=E('<div class="error-message svelte-1hp9571"> </div>'),Ve=E('<p class="empty-state svelte-1hp9571">Cargando clientes...</p>'),Ye=E('<p class="empty-state svelte-1hp9571"> </p>'),Ge=E('<div class="detalle-row svelte-1hp9571"><span class="detalle-icon svelte-1hp9571">ğŸ’³</span> <span class="detalle-text svelte-1hp9571"> </span></div>'),Xe=E('<div class="detalle-row alerta svelte-1hp9571"><span class="detalle-icon svelte-1hp9571">âš ï¸</span> <span class="detalle-text svelte-1hp9571"> </span></div>'),Ze=E('<div class="detalle-row svelte-1hp9571"><span class="detalle-icon svelte-1hp9571">ğŸ“…</span> <span class="detalle-text svelte-1hp9571"> </span></div>'),es=E('<div><div class="cliente-header svelte-1hp9571"><div class="cliente-nombre-estado svelte-1hp9571"><h3 class="svelte-1hp9571"> </h3> <span><!></span></div> <p class="saldo svelte-1hp9571"> </p></div> <div class="cliente-detalles svelte-1hp9571"><div class="detalle-row svelte-1hp9571"><span class="detalle-icon svelte-1hp9571">ğŸ“</span> <span class="detalle-text svelte-1hp9571"> </span></div> <!> <!></div></div>'),ss=E('<div class="clientes-page svelte-1hp9571"><div class="search-container svelte-1hp9571"><div class="search-bar svelte-1hp9571"><svg class="search-icon svelte-1hp9571" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <input type="text" placeholder="Buscar cliente..." class="search-input svelte-1hp9571"/></div> <button class="add-btn svelte-1hp9571" title="Nuevo cliente"><svg class="add-icon svelte-1hp9571" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button></div> <!> <div class="clientes-list svelte-1hp9571"><!></div></div>');function cs(de,pe){Fe(pe,!0);const Q=()=>ie(Re,"$syncCounter",V),ue=()=>ie(We,"$isOnline",V),[V,he]=Oe();let y=w(le([])),f=w(le([])),d=w(""),$=w(!0),I=w(""),F=w(0),Y=null;function G(s){return s?s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/g,"").trim():""}function z(s,o){if(!s||!o)return!1;const _=G(s),C=G(o);if(_.includes(C))return!0;const b=C.split(/\s+/).filter(u=>u.length>0),m=_.split(/\s+/);return b.every(u=>m.some(S=>S.includes(u)))}function _e(){if(console.log("ğŸ” [BUSQUEDA] Filtrando con query:",e(d)),console.log("ğŸ” [BUSQUEDA] Total clientes:",e(y).length),e(d)==="")v(f,[...e(y)],!0),console.log("ğŸ” [BUSQUEDA] Query vacÃ­a, mostrando todos:",e(f).length);else{const s=e(y).filter(o=>{const _=z(o.nombre,e(d)),C=z(o.numero_documento,e(d)),b=z(o.telefono,e(d));return console.log("ğŸ” [BUSQUEDA] Verificando cliente:",o.nombre,{query:e(d),matchNombre:_,matchDocumento:C,matchTelefono:b}),_||C||b});v(f,[...s],!0),console.log("ğŸ” [BUSQUEDA] Filtrados encontrados:",e(f).length)}}ne(()=>{console.log("ğŸ” [BUSQUEDA] Effect ejecutado, searchQuery:",e(d)),clearTimeout(Y),Y=setTimeout(_e,200)});let M=w(0);ne(()=>{Q()!==e(M)&&!e($)&&(console.log("ğŸ”„ [CLIENTES-UI] syncCounter cambiÃ³, recargando clientes...",{anterior:e(M),nuevo:Q()}),v(F,window.scrollY,!0),v(M,Q(),!0),X())}),ze(async()=>(await X(),ue()&&setTimeout(()=>{console.log("ğŸ”„ [CLIENTES] SincronizaciÃ³n automÃ¡tica (pendiente implementaciÃ³n @sync/core)")},100),()=>{}));async function X(){try{v($,!0),v(I,""),console.log("ğŸ“‹ [CLIENTES-UI] Cargando clientes desde Universal Infrastructure...");const s=await Je();console.log("ğŸ“‹ [CLIENTES-UI] Clientes desde DB:",s.length);const o=s.length>0?s:[];console.log(`ğŸ“‹ [CLIENTES-UI] ${o.length} clientes cargados`),v(y,[...o],!0),v(f,[...e(y)],!0),console.log("ğŸ“‹ [CLIENTES] Datos cargados:",{total:e(y).length,filtrados:e(f).length,searchQuery:e(d)})}catch(s){v(I,"Error al cargar clientes"),console.error("Error cargando clientes:",s),v(y,[],!0)}finally{v($,!1),e(F)>0&&setTimeout(()=>{window.scrollTo(0,e(F))},50)}}function fe(){ve("/clientes/nuevo")}function me(s){ve(`/clientes/${s}`)}var j=ss(),O=t(j),P=t(O),Z=c(t(P),2);Pe(Z),a(P);var ge=c(P,2);ge.__click=fe,a(O);var ee=c(O,2);{var xe=s=>{var o=Ke(),_=t(o);a(o),U(()=>x(_,`âš ï¸ ${e(I)??""}`)),i(s,o)};g(ee,s=>{e(I)&&s(xe)})}var se=c(ee,2),Ee=t(se);{var ye=s=>{var o=Ve();i(s,o)},Ce=s=>{var o=B(),_=L(o);{var C=m=>{var u=Ye(),S=t(u,!0);a(u),U(()=>x(S,e(d)?"No se encontraron clientes":"No hay clientes registrados")),i(m,u)},b=m=>{var u=B(),S=L(u);qe(S,17,()=>e(f),N=>N.id+"-"+N.updated_at,(N,r)=>{var k=es();k.__click=()=>me(e(r).id);var q=t(k),R=t(q),W=t(R),Ae=t(W,!0);a(W);var H=c(W,2),we=t(H);{var be=l=>{var n=K("ğŸ”´ Mora");i(l,n)},Te=l=>{var n=B(),p=L(n);{var A=h=>{var T=K("ğŸŸ¢ Al dÃ­a");i(h,T)},D=h=>{var T=K("âšª Sin crÃ©ditos");i(h,T)};g(p,h=>{e(r).estado==="AL_DIA"?h(A):h(D,!1)},!0)}i(l,n)};g(we,l=>{e(r).estado==="MORA"||e(r).estado==="EN_MORA"?l(be):l(Te,!1)})}a(H),a(R);var te=c(R,2),Ue=t(te);a(te),a(q);var ae=c(q,2),J=t(ae),oe=c(t(J),2),Se=t(oe,!0);a(oe),a(J);var re=c(J,2);{var ke=l=>{var n=Ge(),p=c(t(n),2),A=t(p);a(p),a(n),U(()=>x(A,`${e(r).creditosActivos??""} crÃ©dito${e(r).creditosActivos>1?"s":""} activo${e(r).creditosActivos>1?"s":""}`)),i(l,n)};g(re,l=>{e(r).creditosActivos>0&&l(ke)})}var De=c(re,2);{var $e=l=>{var n=Xe(),p=c(t(n),2),A=t(p);a(p),a(n),U(()=>x(A,`${e(r).diasAtraso??""} dÃ­a${e(r).diasAtraso>1?"s":""} de atraso`)),i(l,n)},Ie=l=>{var n=B(),p=L(n);{var A=D=>{var h=Ze(),T=c(t(h),2),Ne=t(T);a(T),a(h),U((Be,Le)=>x(Ne,`PrÃ³ximo pago: $${Be??""} el ${Le??""}`),[()=>e(r).proximoPago.monto.toFixed(2),()=>He(e(r).proximoPago.fecha)]),i(D,h)};g(p,D=>{e(r).proximoPago&&D(A)},!0)}i(l,n)};g(De,l=>{e(r).diasAtraso>0?l($e):l(Ie,!1)})}a(ae),a(k),U((l,n,p)=>{ce(k,1,`cliente-card ${l??""}`,"svelte-1hp9571"),x(Ae,e(r).nombre),ce(H,1,`badge ${n??""}`,"svelte-1hp9571"),x(Ue,`$${p??""}`),x(Se,e(r).telefono)},[()=>e(r).estado?.toLowerCase().replace("_","-")||"sin-creditos",()=>e(r).estado?.toLowerCase().replace("_","-")||"sin-creditos",()=>e(r).saldoTotal?.toFixed(2)||"0.00"]),i(N,k)}),i(m,u)};g(_,m=>{e(f).length===0?m(C):m(b,!1)},!0)}i(s,o)};g(Ee,s=>{e($)?s(ye):s(Ce,!1)})}a(se),a(j),Me(Z,()=>e(d),s=>v(d,s)),i(de,j),je(),he()}Qe(["click"]);export{cs as component};
