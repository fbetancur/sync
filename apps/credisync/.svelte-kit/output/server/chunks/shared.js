import*as x from"devalue";import{t as z,b as O,c as I}from"./utils2.js";function j(s,t,e){t.startsWith("n:")?(t=t.slice(2),e=e===""?void 0:parseFloat(e)):t.startsWith("b:")&&(t=t.slice(2),e=e==="on"),B(s,T(t),e)}function P(s){const t={};for(let e of s.keys()){const n=e.endsWith("[]");let r=s.getAll(e);if(n&&(e=e.slice(0,-2)),r.length>1&&!n)throw new Error(`Form cannot contain duplicated keys â€” "${e}" has ${r.length} values`);r=r.filter(i=>typeof i=="string"||i.name!==""||i.size>0),e.startsWith("n:")?(e=e.slice(2),r=r.map(i=>i===""?void 0:parseFloat(i))):e.startsWith("b:")&&(e=e.slice(2),r=r.map(i=>i==="on")),j(t,e,n?r:r[0])}return t}const R="application/x-sveltekit-formdata",$=0;async function S(s){if(s.headers.get("content-type")!==R){const o=await s.formData();return{data:P(o),meta:{},form_data:o}}if(!s.body)throw new Error("Could not deserialize binary form: no body");const t=s.body.getReader(),e=[];async function n(o){if(o in e)return e[o];let a=e.length;for(;a<=o;)e[a]=t.read().then(c=>c.value),a++;return e[o]}async function r(o,a){let c,d=0,m;for(m=0;;m++){const y=await n(m);if(!y)return null;const L=d+y.byteLength;if(o>=d&&o<L){c=y;break}d=L}if(o+a<=d+c.byteLength)return c.subarray(o-d,o+a-d);const A=new Uint8Array(a);A.set(c.subarray(o-d));let k=c.byteLength-o+d;for(;k<a;){m++;let y=await n(m);if(!y)return null;y.byteLength>a-k&&(y=y.subarray(0,a-k)),A.set(y,k),k+=y.byteLength}return A}const i=await r(0,7);if(!i)throw new Error("Could not deserialize binary form: too short");if(i[0]!==$)throw new Error(`Could not deserialize binary form: got version ${i[0]}, expected version ${$}`);const u=new DataView(i.buffer,i.byteOffset,i.byteLength),l=u.getUint32(1,!0),b=u.getUint16(5,!0),_=await r(7,l);if(!_)throw new Error("Could not deserialize binary form: data too short");let f,h;if(b>0){const o=await r(7+l,b);if(!o)throw new Error("Could not deserialize binary form: file offset table too short");f=JSON.parse(z.decode(o)),h=7+l+b}const[w,E]=x.parse(z.decode(_),{File:([o,a,c,d,m])=>new Proxy(new v(o,a,c,d,n,h+f[m]),{getPrototypeOf(){return File.prototype}})});return(async()=>{let o=!0;for(;o;)o=!!await n(e.length)})(),{data:w,meta:E,form_data:null}}class v{#t;#e;constructor(t,e,n,r,i,u){this.name=t,this.type=e,this.size=n,this.lastModified=r,this.webkitRelativePath="",this.#t=i,this.#e=u,this.arrayBuffer=this.arrayBuffer.bind(this),this.bytes=this.bytes.bind(this),this.slice=this.slice.bind(this),this.stream=this.stream.bind(this),this.text=this.text.bind(this)}#r;async arrayBuffer(){return this.#r??=await new Response(this.stream()).arrayBuffer(),this.#r}async bytes(){return new Uint8Array(await this.arrayBuffer())}slice(t=0,e=this.size,n=this.type){t<0?t=Math.max(this.size+t,0):t=Math.min(t,this.size),e<0?e=Math.max(this.size+e,0):e=Math.min(e,this.size);const r=Math.max(e-t,0);return new v(this.name,n,r,this.lastModified,this.#t,this.#e+t)}stream(){let t=0,e=0;return new ReadableStream({start:async n=>{let r=0,i=null;for(e=0;;e++){const u=await this.#t(e);if(!u)return null;const l=r+u.byteLength;if(this.#e>=r&&this.#e<l){i=u;break}r=l}this.#e+this.size<=r+i.byteLength?(n.enqueue(i.subarray(this.#e-r,this.#e+this.size-r)),n.close()):(n.enqueue(i.subarray(this.#e-r)),t=i.byteLength-this.#e+r)},pull:async n=>{e++;let r=await this.#t(e);if(!r){n.error("Could not deserialize binary form: incomplete file data"),n.close();return}r.byteLength>this.size-t&&(r=r.subarray(0,this.size-t)),n.enqueue(r),t+=r.byteLength,t>=this.size&&n.close()}})}async text(){return z.decode(await this.arrayBuffer())}}const M=/^[a-zA-Z_$]\w*(\.[a-zA-Z_$]\w*|\[\d+\])*$/;function T(s){if(!M.test(s))throw new Error(`Invalid path ${s}`);return s.split(/\.|\[|\]/).filter(Boolean)}function p(s){if(s==="__proto__"||s==="constructor"||s==="prototype")throw new Error(`Invalid key "${s}"`)}function B(s,t,e){let n=s;for(let i=0;i<t.length-1;i+=1){const u=t[i];p(u);const l=/^\d+$/.test(t[i+1]),b=u in n,_=n[u];if(b&&l!==Array.isArray(_))throw new Error(`Invalid array key ${t[i+1]}`);b||(n[u]=l?[]:{}),n=n[u]}const r=t[t.length-1];p(r),n[r]=e}function W(s,t=!1){const e={name:"",path:[],message:s.message,server:t};if(s.path!==void 0){let n="";for(const r of s.path){const i=typeof r=="object"?r.key:r;e.path.push(i),typeof i=="number"?n+=`[${i}]`:typeof i=="string"&&(n+=n===""?i:"."+i)}e.name=n}return e}function U(s){const t={};for(const e of s){(t.$??=[]).push(e);let n="";if(e.path!==void 0)for(const r of e.path)typeof r=="number"?n+=`[${r}]`:typeof r=="string"&&(n+=n===""?r:"."+r),(t[n]??=[]).push(e)}return t}function F(s,t){let e=s;for(const n of t){if(e==null||typeof e!="object")return e;e=e[n]}return e}function g(s,t,e,n,r=[]){const i=()=>F(t(),r);return new Proxy(s,{get(u,l){if(typeof l=="symbol")return u[l];if(/^\d+$/.test(l))return g({},t,e,n,[...r,parseInt(l,10)]);const b=D(r);return l==="set"?g(function(f){return e(r,f),f},t,e,n,[...r,l]):l==="value"?g(i,t,e,n,[...r,l]):l==="issues"||l==="allIssues"?g(()=>{const f=n()[b===""?"$":b];return l==="allIssues"?f?.map(h=>({path:h.path,message:h.message})):f?.filter(h=>h.name===b)?.map(h=>({path:h.path,message:h.message}))},t,e,n,[...r,l]):l==="as"?g((f,h)=>{const w=f==="file multiple"||f==="select multiple"||f==="checkbox"&&typeof h=="string",o={name:(f==="number"||f==="range"?"n:":f==="checkbox"&&!w?"b:":"")+b+(w?"[]":""),get"aria-invalid"(){const a=n();return b in a?"true":void 0}};return f!=="text"&&f!=="select"&&f!=="select multiple"&&(o.type=f==="file multiple"?"file":f),f==="submit"||f==="hidden"?Object.defineProperties(o,{value:{value:h,enumerable:!0}}):f==="select"||f==="select multiple"?Object.defineProperties(o,{multiple:{value:w,enumerable:!0},value:{enumerable:!0,get(){return i()}}}):f==="checkbox"||f==="radio"?Object.defineProperties(o,{value:{value:h??"on",enumerable:!0},checked:{enumerable:!0,get(){const a=i();return f==="radio"?a===h:w?(a??[]).includes(h):a}}}):f==="file"||f==="file multiple"?Object.defineProperties(o,{multiple:{value:w,enumerable:!0},files:{enumerable:!0,get(){const a=i();if(a instanceof File){if(typeof DataTransfer<"u"){const c=new DataTransfer;return c.items.add(a),c.files}return{0:a,length:1}}if(Array.isArray(a)&&a.every(c=>c instanceof File)){if(typeof DataTransfer<"u"){const d=new DataTransfer;return a.forEach(m=>d.items.add(m)),d.files}const c={length:a.length};return a.forEach((d,m)=>{c[m]=d}),c}return null}}}):Object.defineProperties(o,{value:{enumerable:!0,get(){const a=i();return a!=null?String(a):""}}})},t,e,n,[...r,"as"]):g({},t,e,n,[...r,l])}})}function D(s){let t="";for(const e of s)typeof e=="number"?t+=`[${e}]`:t+=t===""?e:"."+e;return t}const Y="x-sveltekit-invalidated",V="x-sveltekit-trailing-slash";function N(s,t){const e=Object.fromEntries(Object.entries(t).map(([n,r])=>[n,r.encode]));return x.stringify(s,e)}function Z(s,t){if(s===void 0)return"";const e=N(s,t),n=new TextEncoder().encode(e);return O(n).replaceAll("=","").replaceAll("+","-").replaceAll("/","_")}function G(s,t){if(!s)return;const e=z.decode(I(s.replaceAll("-","+").replaceAll("_","/"))),n=Object.fromEntries(Object.entries(t).map(([r,i])=>[r,i.decode]));return x.parse(e,n)}function H(s,t){return s+"/"+t}export{R as B,Y as I,V as T,Z as a,g as b,H as c,S as d,j as e,U as f,B as g,W as n,G as p,N as s};
