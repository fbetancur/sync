import{w as o}from"./vendor.js";import{g as y}from"./client.js";import"dexie";import{c as f}from"./utils.js";const u={appName:"CrediSync",version:"1.0.0",supabase:{url:"https://hmnlriywocnpiktflehr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhtbmxyaXl3b2NucGlrdGZsZWhyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzMDE4MzIsImV4cCI6MjA4MDg3NzgzMn0.P4ZZdWAPgby89Rc8yYAZB9f2bwRrRuLEsS_6peobkf4"},offline:{enabled:!0,syncInterval:3e4,maxRetries:3,retryDelay:1e3},sync:{pauseOnActivity:!0,activityTimeout:5e4,forceOnReconnect:!0,maxSyncInterval:3e5},security:{encryption:!0,auditLog:!0,sessionTimeout:1440*60*1e3}},i=f(u);async function c(){try{console.log("ðŸš€ Inicializando CrediSync con @sync/core..."),await i.start(),d(),console.log("âœ… CrediSync inicializado correctamente")}catch(e){throw console.error("âŒ Error inicializando CrediSync:",e),e}}function d(){const e=["scroll","mousemove","mousedown","touchstart","touchmove","keydown","click","input"];let t=null,n=!1;function r(){n=!0,t&&clearTimeout(t),t=setTimeout(()=>{n=!1,navigator.onLine&&i.services.sync.sync({force:!1})},u.sync?.activityTimeout||5e4)}e.forEach(l=>{document.addEventListener(l,r,{passive:!0})}),window.addEventListener("online",()=>{n||i.services.sync.sync({force:!0})}),setTimeout(()=>{navigator.onLine&&!n&&i.services.sync.sync({force:!1})},5e3)}const s=o(null),a=o(!0),v={async initialize(){a.set(!0);try{i.isStarted||(console.log("ðŸ”„ Inicializando CrediSync..."),await c());const t=await i.services.auth.getCurrentUser();s.set(t)}catch(e){console.error("Error initializing auth:",e),s.set(null)}finally{a.set(!1)}},async signIn(e,t){i.isStarted||await c();const r=await i.services.auth.signIn(e,t);return r.error||s.set(r.user),r},async signUp(e,t){i.isStarted||await c();const r=await i.services.auth.signUp(e,t);return!r.error&&r.user&&s.set(r.user),r},async signOut(){i.isStarted||await c();const t=await i.services.auth.signOut();return t.error||(s.set(null),y()),t},isAuthenticated(){let e;return s.subscribe(t=>e=t)(),!!e}};typeof window<"u"&&v.initialize();export{a as l,s as u};
